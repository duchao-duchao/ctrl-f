!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self)["ctrl-f"]=t()}(this,(function(){"use strict";return new class{constructor(e={}){this.options={backgroundColor:"#fff",textColor:"#000",highlightColor:"yellow",currentHighlightColor:"orange",searchBoxWidth:"96%",...e},this.matches=[],this.currentIndex=-1,this.createSearchBox(),this.listenForSearch(),this.clearHighlights()}createSearchBox(){if(this.searchBox)return;this.searchBox=document.createElement("div"),this.searchBox.style.position="fixed",this.searchBox.style.top="10px",this.searchBox.style.right="10px",this.searchBox.style.padding="20px",this.searchBox.style.backgroundColor="#f9f9f9",this.searchBox.style.color=this.options.textColor,this.searchBox.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.1)",this.searchBox.style.borderRadius="10px",this.searchBox.style.zIndex="9999",this.searchBox.style.width="380px";const e=document.createElement("div");e.style.fontSize="16px",e.style.fontWeight="bold",e.style.marginBottom="10px",e.style.display="flex",e.style.justifyContent="space-between",e.style.alignItems="center",e.style.paddingBottom="10px",e.style.borderBottom="1px solid #ddd";const t=document.createElement("div");t.innerText="查找";const o=document.createElement("div");o.innerText="关闭",o.style.cursor="pointer",o.style.color="#d9534f",o.addEventListener("click",(()=>{this.closeSearchBox(),this.clearHighlights()})),e.appendChild(t),e.appendChild(o);const s=document.createElement("input");s.type="text",s.placeholder="Search...",s.style.width=this.options.searchBoxWidth,s.style.padding="10px",s.style.marginTop="10px",s.style.border="1px solid #ccc",s.style.borderRadius="8px",s.style.fontSize="14px",s.style.color="#333",s.style.outline="none",s.style.transition="all 0.3s ease",s.addEventListener("focus",(()=>{s.style.borderColor="#007bff"})),s.addEventListener("blur",(()=>{s.style.borderColor="#ccc"}));const n=document.createElement("div");n.style.marginTop="20px",n.style.display="flex",n.style.justifyContent="space-between";const i=document.createElement("button");i.innerText="上一处",i.style.padding="8px 15px",i.style.backgroundColor="#007bff",i.style.color="#fff",i.style.border="none",i.style.borderRadius="5px",i.style.fontSize="14px",i.style.cursor="pointer",i.style.transition="background-color 0.3s ease",i.addEventListener("click",(()=>this.highlightPrevious())),i.addEventListener("mouseover",(()=>{i.style.backgroundColor="#0056b3"})),i.addEventListener("mouseout",(()=>{i.style.backgroundColor="#007bff"}));const r=document.createElement("button");r.innerText="下一处",r.style.padding="8px 15px",r.style.backgroundColor="#28a745",r.style.color="#fff",r.style.border="none",r.style.borderRadius="5px",r.style.fontSize="14px",r.style.cursor="pointer",r.style.transition="background-color 0.3s ease",r.addEventListener("click",(()=>this.highlightNext())),r.addEventListener("mouseover",(()=>{r.style.backgroundColor="#218838"})),r.addEventListener("mouseout",(()=>{r.style.backgroundColor="#28a745"})),n.appendChild(i),n.appendChild(r),this.searchBox.appendChild(e),this.searchBox.appendChild(s),this.searchBox.appendChild(n),document.body.appendChild(this.searchBox),s.addEventListener("input",(e=>{this.searchText(e.target.value)})),this.makeDraggable(this.searchBox)}closeSearchBox(){this.searchBox&&(document.body.removeChild(this.searchBox),this.searchBox=null)}clearHighlights(){document.querySelectorAll(".highlighted").forEach((e=>{const t=e.parentNode,o=[];let s=e.previousSibling;for(;s;)o.unshift(s),s=s.previousSibling;for(o.push(e),s=e.nextSibling;s;)o.push(s),s=s.nextSibling;const n=o.map((e=>e.textContent)).join(""),i=document.createTextNode(n);t?.replaceChildren(i)})),this.matches=[],this.currentIndex=-1}searchText(e){if(this.clearHighlights(),!e.trim())return;const t=new RegExp(e,"gi");this.getTextNodesUnder(document.body).forEach((o=>{const s=o.textContent.match(t);s&&this.highlightText(o,s,e)}))}getTextNodesUnder(e){const t=[],o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);let s;for(;s=o.nextNode();)t.push(s);return t}highlightText(e,t,o){const s=new RegExp(`(${o})`,"gi"),n=e.textContent.split(s),i=e.parentNode,r=document.createDocumentFragment();n.forEach((e=>{const t=document.createElement("span");e.toLowerCase()===o.toLowerCase()?(t.className="highlighted",0===this.matches.length||this.matches.length===this.currentIndex+1?t.style.backgroundColor=this.options.currentHighlightColor:t.style.backgroundColor=this.options.highlightColor,t.style.fontWeight="bold",t.textContent=e,r.appendChild(t),this.matches.push(t)):r.appendChild(document.createTextNode(e))})),i.replaceChild(r,e)}listenForSearch(){window.addEventListener("keydown",(e=>{(e.ctrlKey||e.metaKey)&&"f"===e.key&&(e.preventDefault(),this.createSearchBox())}))}makeDraggable(e){let t,o,s=!1;e.addEventListener("mousedown",(n=>{s=!0,t=n.clientX-e.getBoundingClientRect().left,o=n.clientY-e.getBoundingClientRect().top})),window.addEventListener("mousemove",(n=>{s&&(e.style.top=n.clientY-o+"px",e.style.left=n.clientX-t+"px")})),window.addEventListener("mouseup",(()=>{s=!1}))}highlightNext(){0!==this.matches.length&&(this.currentIndex=(this.currentIndex+1)%this.matches.length,this.updateHighlightColors(),this.scrollToMatch(this.matches[this.currentIndex]))}highlightPrevious(){0!==this.matches.length&&(this.currentIndex=(this.currentIndex-1+this.matches.length)%this.matches.length,this.updateHighlightColors(),this.scrollToMatch(this.matches[this.currentIndex]))}updateHighlightColors(){this.matches.forEach(((e,t)=>{t===this.currentIndex?e.style.backgroundColor=this.options.currentHighlightColor:e.style.backgroundColor=this.options.highlightColor}))}scrollToMatch(e){e.scrollIntoView({behavior:"smooth",block:"center"})}}}));
