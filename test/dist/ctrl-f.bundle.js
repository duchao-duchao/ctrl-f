!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self)["ctrl-f"]=t()}(this,(function(){"use strict";return new class{constructor(e={}){this.options={backgroundColor:"#fff",textColor:"#000",highlightColor:"yellow",currentHighlightColor:"orange",searchBoxWidth:"96%",...e},this.matches=[],this.currentIndex=-1,this.createSearchBox(),this.listenForSearch(),this.clearHighlights()}createSearchBox(){if(this.searchBox)return;this.searchBox=document.createElement("div"),this.searchBox.style.position="fixed",this.searchBox.style.top="10px",this.searchBox.style.right="10px",this.searchBox.style.padding="10px",this.searchBox.style.backgroundColor=this.options.backgroundColor,this.searchBox.style.color=this.options.textColor,this.searchBox.style.boxShadow="0 2px 10px rgba(0, 0, 0, 0.1)",this.searchBox.style.zIndex="9999",this.searchBox.style.cursor="move",this.searchBox.style.width="376px";const e=document.createElement("input");e.type="text",e.placeholder="Search...",e.style.width=this.options.searchBoxWidth,e.style.padding="5px";const t=document.createElement("div");t.style.height="48px",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="space-between";const i=document.createElement("div");i.innerText="查找";const s=document.createElement("div");s.innerText="关闭",s.addEventListener("click",(()=>{this.closeSearchBox(),this.clearHighlights()})),t.appendChild(i),t.appendChild(s);const o=document.createElement("div");o.style.marginTop="10px",o.style.display="flex",o.style.justifyContent="space-between";const h=document.createElement("button");h.innerText="上一个",h.style.padding="5px 10px",h.addEventListener("click",(()=>this.highlightPrevious()));const n=document.createElement("button");n.innerText="下一个",n.style.padding="5px 10px",n.addEventListener("click",(()=>this.highlightNext())),o.appendChild(h),o.appendChild(n),this.searchBox.appendChild(t),this.searchBox.appendChild(e),this.searchBox.appendChild(o),document.body.appendChild(this.searchBox),e.addEventListener("input",(e=>{this.searchText(e.target.value)})),this.makeDraggable(this.searchBox)}closeSearchBox(){this.searchBox&&(document.body.removeChild(this.searchBox),this.searchBox=null)}clearHighlights(){document.querySelectorAll(".highlighted").forEach((e=>{const t=e.parentNode,i=[];let s=e.previousSibling;for(;s;)i.unshift(s),s=s.previousSibling;for(i.push(e),s=e.nextSibling;s;)i.push(s),s=s.nextSibling;const o=i.map((e=>e.textContent)).join(""),h=document.createTextNode(o);t?.replaceChildren(h)})),this.matches=[],this.currentIndex=-1}searchText(e){if(this.clearHighlights(),!e.trim())return;const t=new RegExp(e,"gi");this.getTextNodesUnder(document.body).forEach((i=>{const s=i.textContent.match(t);s&&this.highlightText(i,s,e)}))}getTextNodesUnder(e){const t=[],i=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);let s;for(;s=i.nextNode();)t.push(s);return t}highlightText(e,t,i){const s=new RegExp(`(${i})`,"gi"),o=e.textContent.split(s),h=e.parentNode,n=document.createDocumentFragment();o.forEach((e=>{const t=document.createElement("span");e.toLowerCase()===i.toLowerCase()?(t.className="highlighted",0===this.matches.length||this.matches.length===this.currentIndex+1?t.style.backgroundColor=this.options.currentHighlightColor:t.style.backgroundColor=this.options.highlightColor,t.style.fontWeight="bold",t.textContent=e,n.appendChild(t),this.matches.push(t)):n.appendChild(document.createTextNode(e))})),h.replaceChild(n,e)}listenForSearch(){window.addEventListener("keydown",(e=>{(e.ctrlKey||e.metaKey)&&"f"===e.key&&(e.preventDefault(),this.createSearchBox())}))}makeDraggable(e){let t,i,s=!1;e.addEventListener("mousedown",(o=>{s=!0,t=o.clientX-e.getBoundingClientRect().left,i=o.clientY-e.getBoundingClientRect().top})),window.addEventListener("mousemove",(o=>{s&&(e.style.top=o.clientY-i+"px",e.style.left=o.clientX-t+"px")})),window.addEventListener("mouseup",(()=>{s=!1}))}highlightNext(){0!==this.matches.length&&(this.currentIndex=(this.currentIndex+1)%this.matches.length,this.updateHighlightColors(),this.scrollToMatch(this.matches[this.currentIndex]))}highlightPrevious(){0!==this.matches.length&&(this.currentIndex=(this.currentIndex-1+this.matches.length)%this.matches.length,this.updateHighlightColors(),this.scrollToMatch(this.matches[this.currentIndex]))}updateHighlightColors(){this.matches.forEach(((e,t)=>{t===this.currentIndex?e.style.backgroundColor=this.options.currentHighlightColor:e.style.backgroundColor=this.options.highlightColor}))}scrollToMatch(e){e.scrollIntoView({behavior:"smooth",block:"center"})}}}));
